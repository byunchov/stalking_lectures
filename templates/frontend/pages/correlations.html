{% extends 'frontend/base.html' %}
{% load static %}

{% block title %}Корелационен анализ{% endblock %}
{% block header %}Moodle ПТС{% endblock %}
{% block content %}

<div class="container mt-n10">
  <div class="row">
    <div class="col-lg-9">
      <div class="card mb-4">
        <div class="card-header d-flex align-items-center">
          <a class="btn btn-transparent-dark btn-icon" href="{% url 'analysis_item' item.id %}">
            <i class="fas fa-arrow-left"></i>
          </a>
          <div class="ml-3">
            <h2 class="my-1">Корелационен анализ</h2>
          </div>
        </div>
        <div class="card-body">
          <table id="correlfreqDistDT" class="table table-striped table-bordered table-responsive-sm rounded"
            style="width: 100%;" cellspacing="0">
            <thead>
              <tr>
                <th>Студент</th>
                <th>Оценка</th>
                <th>Преглеждания</th>
                <th>Относителна честота</th>
              </tr>
            </thead>
          </table>
        </div>
      </div>
    </div>
    <div class="col-lg-3">
      <div class="nav-sticky">
        <div class="card">
          <div class="card-body">
            <ul class="nav flex-column" id="stickyNavigator">
              <li class="nav-item"><a class="nav-link" href="{% url 'freq_dist' item.id %}">Честотно разпределение</a>
              </li>
              <li class="nav-item"><a class="nav-link" href="{% url 'trend' item.id %}">Мерки на централната
                  тенденция</a></li>
              <li class="nav-item"><a class="nav-link" href="{% url 'spread' item.id %}">Мерки на разсейване</a></li>
              <li class="nav-item"><a class="nav-link" href="{% url 'correlations' item.id %}">Корелационен анализ</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block styles %}
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.24/css/dataTables.bootstrap4.min.css">
{% endblock %}


{% block scripts %}
<script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.24/js/dataTables.bootstrap4.min.js"></script>

<script>

  var sample_data = [
    { "ID": 6532, "Result": 6.0, "View Count": 66, "Result rel freq": 0.73 },
    { "ID": 7448, "Result": 5.0, "View Count": 2, "Result rel freq": 0.02 },
    { "ID": 7907, "Result": 6.0, "View Count": 42, "Result rel freq": 0.47 },
    { "ID": 7909, "Result": 4.0, "View Count": 28, "Result rel freq": 0.31 },
    { "ID": 7910, "Result": 5.0, "View Count": 58, "Result rel freq": 0.65 },
    { "ID": 7911, "Result": 4.0, "View Count": 31, "Result rel freq": 0.34 },
  ]

  $(document).ready(function () {
    let path = window.location.href;
    $("#stickyNavigator a.nav-link").each(function () {
      if (this.href === path) {
        $(this).addClass("active");
      }
    });

    $(document).ready(function () {
      var csrftoken = Cookies.get('csrftoken');

      $('#correlfreqDistDT').DataTable({
        // data: sample_data,
        ajax: {
          headers: {'X-CSRFToken': csrftoken},
          url: "{% url 'api_corr_freq_dist' %}",
          type: 'POST',
          data:{upload_id: '{{ item.id }}'},
          dataSrc: '',
        },
        columns: [
          { "data": "id" },
          { "data": "result" },
          { "data": "view_count" },
          { "data": "result_rel_freq" },
        ],
        columnDefs: [
          { className: "font-weight-bold", "targets": [0] },
        ],
      });
    });

  });
</script>
{% endblock %}