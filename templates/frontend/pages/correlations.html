{% extends 'frontend/base.html' %}
{% load static %}

{% block title %}Корелационен анализ{% endblock %}
{% block header %}{{ item.platform_name }} > {{ item.course_name }}{% endblock %}

{% block header_desc %}
{{ item.platform_type}} @ {{ item.platform_url }}
{% endblock %}

{% block content %}

<div class="container mt-n10">
  <div class="row">
    <div class="col-lg-9">
      <div class="card mb-4">
        <div class="card-header d-flex align-items-center">
          <a class="btn btn-transparent-dark btn-icon" href="{% url 'analysis_item' item.id %}">
            <i class="fas fa-arrow-left"></i>
          </a>
          <div class="ml-3">
            <h2 class="my-1">Корелационен анализ</h2>
          </div>
        </div>
        <div class="card-body">
          <h3 class="text-primary mt-3 mb-4">Корелационен анализ на данните за броя прегледани лекции</h3>
          <table id="correlationDT" class="table table-striped table-bordered table-responsive-sm rounded">
            <thead class="bg-white">
              <tr>
                <th>Коефициент на корелация</th>
                <th>Сила на зависимостта</th>
                <th>Посока на зависимостта</th>
              </tr>
            </thead>
          </table>
          <h3 class="text-primary mt-3 mb-4">Честотното разпределение на данните за броя прегледани лекции</h3>
          <table id="correlFreqDistDT" class="table table-striped table-bordered table-responsive-sm rounded"
            style="width: 100%;" cellspacing="0">
            <thead class="bg-white">
              <tr>
                <th>Студент</th>
                <th>Оценка</th>
                <th>Преглеждания</th>
                <th>Относителна честота</th>
              </tr>
            </thead>
          </table>
        </div>
      </div>
    </div>
    <div class="col-lg-3">
      <div class="nav-sticky">
        <div class="card">
          <div class="card-body">
            <ul class="nav flex-column" id="stickyNavigator">
              <li class="nav-item"><a class="nav-link" href="{% url 'freq_dist' item.id %}">Честотно разпределение</a>
              </li>
              <li class="nav-item"><a class="nav-link" href="{% url 'trend' item.id %}">Мерки на централната
                  тенденция</a></li>
              <li class="nav-item"><a class="nav-link" href="{% url 'spread' item.id %}">Мерки на разсейване</a></li>
              <li class="nav-item"><a class="nav-link" href="{% url 'correlations' item.id %}">Корелационен анализ</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block styles %}
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.24/css/dataTables.bootstrap4.min.css">
{% endblock %}


{% block scripts %}
<script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.24/js/dataTables.bootstrap4.min.js"></script>

<script>

  $(document).ready(function () {
    let path = window.location.href;
    $("#stickyNavigator a.nav-link").each(function () {
      if (this.href === path) {
        $(this).addClass("active");
      }
    });

    $(document).ready(function () {
      var csrftoken = Cookies.get('csrftoken');

      $('#correlationDT').DataTable({
        // data: sample_data,
        ajax: {
          headers: { 'X-CSRFToken': csrftoken },
          url: "{% url 'api_correlation' %}",
          type: 'POST',
          data: { upload_id: '{{ item.id }}' },
          // converters: {"text json": JSON.parse, "text xml": jQuery.parseXML},
          // contentType: 'application/json; charset=UTF-8',
          // processData: false,
          dataType: 'json',
          dataSrc: '',
        },
        columns: [
          { "data": "quotient" },
          { "data": "dependency" },
          { "data": "direction" },
        ],
        "processing": false,
        "serverSide": false,
        "paging": false,
        "ordering": false,
        "info": false,
        "searching": false,
        "autoWidth": true,
      });

      $('#correlFreqDistDT').DataTable({
        // data: sample_data,
        ajax: {
          headers: { 'X-CSRFToken': csrftoken },
          url: "{% url 'api_corr_freq_dist' %}",
          type: 'POST',
          data: { upload_id: '{{ item.id }}' },
          dataType: 'json',
          dataSrc: '',
        },
        columns: [
          { "data": "id" },
          { "data": "result" },
          { "data": "view_count" },
          { "data": "result_rel_freq" },
        ],
        pageLength: 5,
        lengthMenu: [[5, 10, 15, 20, 25, 50, -1], [5, 10, 15, 20, 25, 50, "All"]],
        paging: true,
      });
    });

  });
</script>
{% endblock %}